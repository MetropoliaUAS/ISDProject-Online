{"version":3,"sources":["dashboard.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"dashboard.js","sourcesContent":["(function ($, Vue) {\n    \"use strict\";\n\n//    var chart_data = {\n//        labels: [@foreach($samplings as $value) , @endforeach],\n//    series: [[@foreach($samplings as $value) {{$value->sampled}}, @endforeach]]\n//};\n\n    function Dashboard () {\n        this.products = [];\n        this.genericSensorsRepo = new GenericSensorsRepo();\n        this.selection = new Selection();\n\n        this.vue = this.createVue();\n        this.chart = null;\n    }\n\n    Dashboard.prototype.createVue = function () {\n        var self = this;\n\n        return new Vue({\n            el: '#products',\n            data: {\n                products: self.products,\n                selection: self.selection\n            },\n            methods: {\n                onSensorClick: function (sensor) {\n                    dashboard.selection.selectSensor(sensor);\n                },\n                genericSensorAlias: function (genericSensorId) {\n                    var genericSensor = dashboard.genericSensorsRepo.find(genericSensorId);\n                    return genericSensor ? genericSensor.alias : \"\";\n                }\n            }\n        });\n    };\n\n    Dashboard.prototype.run = function () {\n        var self = this,\n            productsUrl = window.location.origin + \"/api/products\";\n\n        $.getJSON(productsUrl, null, function (data) {\n            $.each(data, function (index, item) {\n                self.products.push( new Product(item) );\n            });\n        });\n\n        //this.chart = new Chart();\n    };\n\n    Dashboard.prototype.productIdBySensor = function (sensor) {\n        var foundProduct = null,\n            sensorId = sensor.id || sensor;\n\n\n        $.each(this.products, function (index, product) {\n            $.each(product.sensors, function (index, sensor) {\n                if (sensor.id === sensorId) {\n                    foundProduct = product;\n                    return false;\n                }\n            });\n\n            if (foundProduct) return false;\n        });\n\n        return foundProduct;\n    };\n\n    Dashboard.prototype.selectionChange = function () {\n        this.getNewSamples();\n    };\n\n    Dashboard.prototype.getNewSamples = function () {\n        var samplesUrl, requestParams;\n\n        samplesUrl = window.location.origin + \"/api/samplings/show/\" + this.selection.selectedProductId;\n        requestParams = {\n            generic_sensor_id: this.selection.selectedGenericSensorId,\n            start: \"2001-01-01\"\n        };\n        // change second param to have a better filter\n        $.getJSON(samplesUrl, requestParams, function (data) {\n            console.log(data);\n        });\n    };\n\n    function Selection () {\n        this.selectedSensorId = null;\n        this.selectedProductId = null;\n        this.selectedGenericSensorId = null;\n    }\n\n    Selection.prototype.selectSensor = function (sensor) {\n        this.selectedSensorId = sensor.id;\n        this.selectedGenericSensorId = sensor.generic_sensor_id;\n        this.selectedProductId = dashboard.productIdBySensor(sensor).id;\n\n        dashboard.selectionChange();\n    };\n\n    function Product (raw) {\n        var self = this;\n\n        this.id = raw.id;\n        this.sensors = [];\n\n        $.each(raw.sensors, function (index, rawSensor) {\n            self.sensors.push( new Sensor(rawSensor) );\n        });\n    }\n\n    function Sensor (raw) {\n        this.id = raw.id;\n        this.generic_sensor_id = raw.generic_sensor_id;\n        this.generic_sensor = dashboard.genericSensorsRepo.findOrCreateFromRaw(raw.generic_sensor);\n    }\n\n    function GenericSensor (raw) {\n        this.id = raw.id;\n        this.unit = raw.unit;\n        this.alias = raw.alias;\n        this.symbol = raw.symbol;\n        this.unit = raw.unit;\n    }\n\n    // used to not duplicate object for nothing\n    function GenericSensorsRepo () {\n        this.genericSensors = {};\n    }\n\n    GenericSensorsRepo.prototype.findOrCreateFromRaw = function (raw) {\n        if (this.genericSensors[raw.id]) return this.genericSensors[raw.id];\n\n        var newGenericSensor = new GenericSensor(raw);\n        this.genericSensors[newGenericSensor.id] = newGenericSensor;\n        return newGenericSensor;\n    };\n\n    GenericSensorsRepo.prototype.find = function (id) {\n        return this.genericSensors[id];\n    };\n\n    function Chart () {\n        var chart_options = {\n            fullWidth: true,\n            showArea: false,\n            // No interpolation\n            lineSmooth: false,\n            // Don't draw the line chart points\n            showPoint: false,\n            // X-Axis specific configuration\n            axisX: {\n                // Disable the grid for this axis\n                showGrid: false\n            },\n            // Y-Axis specific configuration\n            axisY: {\n                // Offset from the left to see labels\n                offset: 40\n                // Adding units to the values\n                //labelInterpolationFnc: function(value) {\n                //    return value + '{{$sensor->genericSensor->unit}}';\n                //}\n            }\n        };\n        this.chart = new Chartist.Line('#chartist_chart', null, chart_options);\n    }\n\n    Chart.prototype.update = function (newData) {\n        this.chart.update(newData);\n    };\n\n    $(document).on(\"ready\", function () {\n        window.dashboard = new Dashboard();\n        dashboard.run();\n    });\n})(jQuery, Vue);"],"sourceRoot":"/source/"}